<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Organize.Quest - Discover & Create Local Organizations</title>
    <meta name="description" content="Build your local community network. Create, discover, and join organizations in your neighborhood.">
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Cdefs%3E%3ClinearGradient id='grad' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' style='stop-color:%235865F2'/%3E%3Cstop offset='100%25' style='stop-color:%234ECDC4'/%3E%3C/linearGradient%3E%3C/defs%3E%3Ccircle cx='50' cy='50' r='45' fill='url(%23grad)'/%3E%3Cpath d='M50 20 L65 40 L85 40 L70 55 L75 75 L50 60 L25 75 L30 55 L15 40 L35 40 Z' fill='white'/%3E%3C/svg%3E">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #5865F2;
            --primary-dark: #4752C4;
            --secondary: #FF6B6B;
            --accent: #4ECDC4;
            --dark: #1a1a2e;
            --light: #f8f9fa;
            --gray: #6c757d;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            overflow-x: hidden;
            background: white;
        }

        nav {
            position: fixed;
            top: 0;
            width: 100%;
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(20px);
            z-index: 1000;
            padding: 1rem 0;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        }

        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 1.8rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            cursor: pointer;
        }

        .nav-buttons {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .lang-switcher {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }

        .lang-btn {
            background: rgba(88, 101, 242, 0.1);
            color: var(--dark);
            border: 2px solid rgba(88, 101, 242, 0.2);
            padding: 0.4rem 0.6rem;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.3rem;
            transition: all 0.3s ease;
            line-height: 1;
        }

        .lang-btn:hover {
            background: rgba(88, 101, 242, 0.15);
            transform: translateY(-1px);
        }

        .lang-btn.active {
            background: var(--primary);
            border-color: var(--primary);
            box-shadow: 0 2px 8px rgba(88, 101, 242, 0.3);
        }

        .user-menu {
            position: relative;
        }

        .user-menu-btn {
            background: var(--primary);
            color: white;
            padding: 0.6rem 1.5rem;
            border: none;
            border-radius: 50px;
            font-weight: 600;
            cursor: pointer;
            font-size: 0.95rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .user-dropdown {
            position: absolute;
            top: calc(100% + 10px);
            right: 0;
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.15);
            min-width: 200px;
            display: none;
            z-index: 1001;
            overflow: hidden;
        }

        .user-dropdown.show {
            display: block;
        }

        .dropdown-item {
            padding: 0.8rem 1.2rem;
            cursor: pointer;
            transition: background 0.3s ease;
            color: #333;
            text-decoration: none;
            display: block;
            font-size: 0.95rem;
        }

        .dropdown-item:hover {
            background: var(--light);
        }

        .dropdown-divider {
            height: 1px;
            background: #e0e0e0;
            margin: 0.5rem 0;
        }

        .btn-login {
            background: transparent;
            color: var(--primary);
            padding: 0.6rem 1.5rem;
            border: 2px solid var(--primary);
            border-radius: 50px;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s ease;
            font-size: 0.95rem;
            cursor: pointer;
        }

        .btn-login:hover {
            background: var(--primary);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(88, 101, 242, 0.3);
        }

        .btn-nav {
            background: var(--primary);
            color: white;
            padding: 0.6rem 1.5rem;
            border-radius: 50px;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s ease;
            font-size: 0.95rem;
            cursor: pointer;
            border: none;
        }

        .btn-nav:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(88, 101, 242, 0.3);
        }

        .hero {
            padding: 8rem 2rem 4rem;
            min-height: 90vh;
            display: flex;
            align-items: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            position: relative;
            overflow: hidden;
        }

        .hero-container {
            max-width: 1200px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 4rem;
            align-items: center;
            position: relative;
            z-index: 1;
        }

        .hero-content h1 {
            font-size: 3.5rem;
            font-weight: 800;
            margin-bottom: 1.5rem;
            color: white;
            line-height: 1.2;
        }

        .hero-content p {
            font-size: 1.3rem;
            margin-bottom: 2rem;
            color: rgba(255, 255, 255, 0.9);
        }

        .hero-buttons {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .btn-primary {
            background: white;
            color: var(--primary);
            padding: 1rem 2.5rem;
            border-radius: 50px;
            text-decoration: none;
            font-weight: 700;
            font-size: 1.1rem;
            transition: all 0.3s ease;
            cursor: pointer;
            border: none;
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3);
        }

        .map-app {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            background: white;
            z-index: 2000;
        }

        .map-app.active {
            display: block;
        }

        .map-header {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            background: rgba(255, 255, 255, 0.98);
            padding: 1rem 2rem;
            z-index: 1000;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .map-container {
            display: grid;
            grid-template-columns: 1fr 400px;
            height: 100vh;
            padding-top: 70px;
        }

        #map {
            width: 100%;
            height: 100%;
        }

        .map-sidebar {
            background: var(--light);
            padding: 2rem;
            overflow-y: auto;
        }

        .map-btn {
            width: 100%;
            padding: 0.8rem;
            margin-bottom: 0.5rem;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
        }

        .map-btn-primary {
            background: var(--primary);
            color: white;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 3000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
        }

        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            padding: 2.5rem;
            border-radius: 20px;
            width: 90%;
            max-width: 500px;
            position: relative;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-close {
            position: absolute;
            right: 20px;
            top: 20px;
            font-size: 1.5rem;
            cursor: pointer;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 0.8rem;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1rem;
        }
    </style>
</head>
<body>
    <div class="landing-page" id="landingPage">
        <nav>
            <div class="nav-container">
                <div class="logo" id="logoText">üåç Organize.Quest</div>
                <div class="nav-buttons">
                    <div class="lang-switcher">
                        <button class="lang-btn active" id="btnEN">EN</button>
                        <button class="lang-btn" id="btnTR">TR</button>
                    </div>
                    <a href="profile.html" class="btn-login" id="loginBtn">Log In</a>
                    <div class="user-menu" id="userMenu" style="display: none;">
                        <button class="user-menu-btn" id="userMenuBtn">
                            üë§ <span id="userMenuName">My Account</span> ‚ñº
                        </button>
                        <div class="user-dropdown" id="userDropdown">
                            <a href="profile.html" class="dropdown-item">üìù My Account</a>
                            <div class="dropdown-divider"></div>
                            <a href="#" class="dropdown-item" id="logoutDropdown">üö™ Logout</a>
                        </div>
                    </div>
                    <button class="btn-nav" id="openMapBtn">Open Map</button>
                </div>
            </div>
        </nav>

        <section class="hero">
            <div class="hero-container">
                <div class="hero-content">
                    <h1 id="heroTitle">Build Your Local Community Network</h1>
                    <p id="heroDesc">Create, discover, and join organizations in your neighborhood.</p>
                    <div class="hero-buttons">
                        <button class="btn-primary" id="heroMapBtn">Start Exploring</button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Features Section -->
        <section style="padding: 4rem 2rem; background: white;">
            <div style="max-width: 1200px; margin: 0 auto;">
                <h2 id="featuresTitle" style="text-align: center; font-size: 2.5rem; margin-bottom: 3rem; color: var(--dark);">Why Choose Organize.Quest?</h2>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 2rem;">
                    <div style="text-align: center; padding: 2rem;">
                        <div style="font-size: 3rem; margin-bottom: 1rem;">üó∫Ô∏è</div>
                        <h3 id="feature1Title" style="color: var(--primary); margin-bottom: 1rem;">Interactive Map</h3>
                        <p id="feature1Desc" style="color: var(--gray);">Discover local organizations on an easy-to-use interactive map with real-time updates.</p>
                    </div>
                    <div style="text-align: center; padding: 2rem;">
                        <div style="font-size: 3rem; margin-bottom: 1rem;">ü§ù</div>
                        <h3 id="feature2Title" style="color: var(--primary); margin-bottom: 1rem;">Community Driven</h3>
                        <p id="feature2Desc" style="color: var(--gray);">Connect with like-minded people and build meaningful relationships in your area.</p>
                    </div>
                    <div style="text-align: center; padding: 2rem;">
                        <div style="font-size: 3rem; margin-bottom: 1rem;">üìÖ</div>
                        <h3 id="feature3Title" style="color: var(--primary); margin-bottom: 1rem;">Event Management</h3>
                        <p id="feature3Desc" style="color: var(--gray);">Create and manage events, track participants, and organize community activities.</p>
                    </div>
                    <div style="text-align: center; padding: 2rem;">
                        <div style="font-size: 3rem; margin-bottom: 1rem;">üîí</div>
                        <h3 id="feature4Title" style="color: var(--primary); margin-bottom: 1rem;">Safe & Secure</h3>
                        <p id="feature4Desc" style="color: var(--gray);">Your data is protected with enterprise-level security and privacy controls.</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- How It Works Section -->
        <section style="padding: 4rem 2rem; background: var(--light);">
            <div style="max-width: 1200px; margin: 0 auto;">
                <h2 id="howItWorksTitle" style="text-align: center; font-size: 2.5rem; margin-bottom: 3rem; color: var(--dark);">How It Works</h2>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 2rem;">
                    <div style="text-align: center;">
                        <div style="width: 60px; height: 60px; background: var(--primary); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; font-weight: bold; margin: 0 auto 1rem;">1</div>
                        <h3 id="step1Title" style="color: var(--dark); margin-bottom: 0.5rem;">Create Account</h3>
                        <p id="step1Desc" style="color: var(--gray);">Sign up in seconds with just your email</p>
                    </div>
                    <div style="text-align: center;">
                        <div style="width: 60px; height: 60px; background: var(--primary); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; font-weight: bold; margin: 0 auto 1rem;">2</div>
                        <h3 id="step2Title" style="color: var(--dark); margin-bottom: 0.5rem;">Explore Map</h3>
                        <p id="step2Desc" style="color: var(--gray);">Browse organizations in your area</p>
                    </div>
                    <div style="text-align: center;">
                        <div style="width: 60px; height: 60px; background: var(--primary); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; font-weight: bold; margin: 0 auto 1rem;">3</div>
                        <h3 id="step3Title" style="color: var(--dark); margin-bottom: 0.5rem;">Create or Join</h3>
                        <p id="step3Desc" style="color: var(--gray);">Start your own or join existing groups</p>
                    </div>
                    <div style="text-align: center;">
                        <div style="width: 60px; height: 60px; background: var(--primary); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; font-weight: bold; margin: 0 auto 1rem;">4</div>
                        <h3 id="step4Title" style="color: var(--dark); margin-bottom: 0.5rem;">Connect & Grow</h3>
                        <p id="step4Desc" style="color: var(--gray);">Build your community network</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- About Us Section -->
        <section style="padding: 4rem 2rem; background: white;">
            <div style="max-width: 900px; margin: 0 auto; text-align: center;">
                <h2 id="aboutTitle" style="font-size: 2.5rem; margin-bottom: 2rem; color: var(--dark);">About Organize.Quest</h2>
                <p id="aboutText1" style="font-size: 1.2rem; color: var(--gray); line-height: 1.8; margin-bottom: 2rem;">
                    Organize.Quest is a platform dedicated to strengthening local communities by making it easy to discover, create, and participate in community organizations and events. We believe that strong communities are built on meaningful connections and shared experiences.
                </p>
                <p id="aboutText2" style="font-size: 1.2rem; color: var(--gray); line-height: 1.8;">
                    Whether you're looking to volunteer, find a local sports team, attend cultural events, or start your own community initiative, Organize.Quest connects you with opportunities right in your neighborhood.
                </p>
            </div>
        </section>

        <!-- FAQ Section -->
        <section style="padding: 4rem 2rem; background: var(--light);">
            <div style="max-width: 900px; margin: 0 auto;">
                <h2 id="faqTitle" style="text-align: center; font-size: 2.5rem; margin-bottom: 3rem; color: var(--dark);">Frequently Asked Questions</h2>
                <div style="display: flex; flex-direction: column; gap: 1.5rem;">
                    <details style="background: white; padding: 1.5rem; border-radius: 10px; cursor: pointer;">
                        <summary id="faq1Q" style="font-weight: 600; color: var(--dark); font-size: 1.1rem;">Is Organize.Quest free to use?</summary>
                        <p id="faq1A" style="margin-top: 1rem; color: var(--gray);">Yes! Organize.Quest is completely free for users to browse organizations, create their own groups, and participate in community events.</p>
                    </details>
                    <details style="background: white; padding: 1.5rem; border-radius: 10px; cursor: pointer;">
                        <summary id="faq2Q" style="font-weight: 600; color: var(--dark); font-size: 1.1rem;">How do I create an organization?</summary>
                        <p id="faq2A" style="margin-top: 1rem; color: var(--gray);">Simply sign up for an account, click on the map where you want to place your organization, fill out the details, and publish. Your organization will be visible to everyone in the community.</p>
                    </details>
                    <details style="background: white; padding: 1.5rem; border-radius: 10px; cursor: pointer;">
                        <summary id="faq3Q" style="font-weight: 600; color: var(--dark); font-size: 1.1rem;">Can I edit or delete my organization?</summary>
                        <p id="faq3A" style="margin-top: 1rem; color: var(--gray);">Yes! Go to your profile page and click on "My Organizations" to manage all your created organizations. You can edit details or delete them at any time.</p>
                    </details>
                    <details style="background: white; padding: 1.5rem; border-radius: 10px; cursor: pointer;">
                        <summary id="faq4Q" style="font-weight: 600; color: var(--dark); font-size: 1.1rem;">What types of organizations can I create?</summary>
                        <p id="faq4A" style="margin-top: 1rem; color: var(--gray);">You can create any type of community organization including educational groups, healthcare initiatives, technology communities, non-profits, sports teams, arts collectives, environmental groups, and general community organizations.</p>
                    </details>
                    <details style="background: white; padding: 1.5rem; border-radius: 10px; cursor: pointer;">
                        <summary id="faq5Q" style="font-weight: 600; color: var(--dark); font-size: 1.1rem;">Is my personal information safe?</summary>
                        <p id="faq5A" style="margin-top: 1rem; color: var(--gray);">We take privacy seriously. Your personal information is encrypted and stored securely. We never share your data with third parties without your explicit consent.</p>
                    </details>
                    <details style="background: white; padding: 1.5rem; border-radius: 10px; cursor: pointer;">
                        <summary id="faq6Q" style="font-weight: 600; color: var(--dark); font-size: 1.1rem;">How do I find organizations near me?</summary>
                        <p id="faq6A" style="margin-top: 1rem; color: var(--gray);">Click "Find My Location" on the map and we'll show you all organizations in your area. You can also use filters to search by category, distance, and event type.</p>
                    </details>
                </div>
            </div>
        </section>

        <!-- Footer -->
        <footer style="background: var(--dark); color: white; padding: 3rem 2rem;">
            <div style="max-width: 1200px; margin: 0 auto; text-align: center;">
                <h3 style="font-size: 1.8rem; margin-bottom: 1rem; background: linear-gradient(135deg, var(--primary), var(--accent)); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">Organize.Quest</h3>
                <p id="footerTagline" style="opacity: 0.8; margin-bottom: 2rem;">Building stronger communities, one connection at a time</p>
                <div style="display: flex; justify-content: center; gap: 2rem; flex-wrap: wrap; margin-bottom: 2rem;">
                    <a id="footerHome" href="index.html" style="color: white; text-decoration: none; opacity: 0.8;">Home</a>
                    <a id="footerOrgs" href="organizations.html" style="color: white; text-decoration: none; opacity: 0.8;">Organizations</a>
                    <a id="footerProfile" href="profile.html" style="color: white; text-decoration: none; opacity: 0.8;">Profile</a>
                </div>
                <p id="footerCopyright" style="opacity: 0.6; font-size: 0.9rem;">¬© 2025 Organize.Quest. All rights reserved.</p>
            </div>
        </footer>
    </div>

    <div class="map-app" id="mapApp">
        <div class="map-header">
            <h2>üåç <span id="mapTitle">Organize.Quest Map</span></h2>
            <button class="btn-primary" id="closeMapBtn">‚Üê Back</button>
        </div>
        <div class="map-container">
            <div id="map"></div>
            <div class="map-sidebar">
                <button class="map-btn map-btn-primary" id="findLocationBtn">üìç Find My Location</button>
                <button class="map-btn map-btn-primary" id="createOrgBtn">‚ûï Create Organization</button>
                <div id="orgList"></div>
            </div>
        </div>
    </div>

    <div id="createModal" class="modal">
        <div class="modal-content">
            <span class="modal-close" id="modalCloseBtn">&times;</span>
            <h2 id="modalTitle">Create Organization</h2>
            <form id="createOrgForm">
                <div class="form-group">
                    <label id="orgNameLabel">Organization Name *</label>
                    <input type="text" id="orgName" required placeholder="Enter organization name">
                </div>
                <div class="form-group">
                    <label id="orgCategoryLabel">Category *</label>
                    <select id="orgCategory" required>
                        <option value="">Select</option>
                        <option value="Education">üéì Education</option>
                        <option value="Healthcare">üè• Healthcare</option>
                        <option value="Technology">üíª Technology</option>
                        <option value="Non-Profit">ü§ù Non-Profit</option>
                        <option value="Sports">‚öΩ Sports</option>
                        <option value="Arts">üé® Arts</option>
                        <option value="Community">üèôÔ∏è Community</option>
                    </select>
                </div>
                <div class="form-group">
                    <label id="orgDescLabel">Description</label>
                    <textarea id="orgDescription" placeholder="Describe your organization"></textarea>
                </div>
                <div class="form-group">
                    <label id="orgDeadlineLabel">Organization Deadline *</label>
                    <input type="date" id="orgDeadline" required>
                </div>
                <div class="form-group">
                    <label id="orgDeadlineTimeLabel">Deadline Time (optional)</label>
                    <input type="time" id="orgDeadlineTime">
                </div>
                <div class="form-group">
                    <label id="orgLocationLabel">Location on Map *</label>
                    <input type="text" id="orgLocationDisplay" readonly placeholder="Click on map to select location" style="background: #f0f0f0; cursor: not-allowed;">
                </div>
                <button type="submit" class="map-btn map-btn-primary" id="createOrgSubmit">Create Organization</button>
            </form>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        const SUPABASE_URL = 'https://ymrxfbkghznrosgfqwrh.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InltcnhmYmtnaHpucm9zZ2Zxd3JoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg0NzQ4MTMsImV4cCI6MjA3NDA1MDgxM30.GyrbrTmWMc6--zCUcfKwc-2qlsBI0z3oly8iv9Fq9-0';
        
        let supabase;
        try {
            if (window.supabase) {
                supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
            }
        } catch (err) {
            console.error('Supabase initialization error:', err);
        }
        
        let currentLang = 'en';
        let map, userMarker, organizations = [], createMode = false, selectedLocation = null;
        let currentUser = null;
        let joinedOrgIds = new Set();

        const translations = {
            en: {
                heroTitle: 'Build Your Local Community Network',
                heroDesc: 'Create, discover, and join organizations in your neighborhood.',
                startBtn: 'Start Exploring',
                loginBtn: 'Log In',
                openMapBtn: 'Open Map',
                myAccount: 'My Account',
                logout: 'Logout',
                featuresTitle: 'Why Choose Organize.Quest?',
                feature1Title: 'Interactive Map',
                feature1Desc: 'Discover local organizations on an easy-to-use interactive map with real-time updates.',
                feature2Title: 'Community Driven',
                feature2Desc: 'Connect with like-minded people and build meaningful relationships in your area.',
                feature3Title: 'Event Management',
                feature3Desc: 'Create and manage events, track participants, and organize community activities.',
                feature4Title: 'Safe & Secure',
                feature4Desc: 'Your data is protected with enterprise-level security and privacy controls.',
                howItWorksTitle: 'How It Works',
                step1Title: 'Create Account',
                step1Desc: 'Sign up in seconds with just your email',
                step2Title: 'Explore Map',
                step2Desc: 'Browse organizations in your area',
                step3Title: 'Create or Join',
                step3Desc: 'Start your own or join existing groups',
                step4Title: 'Connect & Grow',
                step4Desc: 'Build your community network',
                aboutTitle: 'About Organize.Quest',
                aboutText1: 'Organize.Quest is a platform dedicated to strengthening local communities by making it easy to discover, create, and participate in community organizations and events. We believe that strong communities are built on meaningful connections and shared experiences.',
                aboutText2: 'Whether you\'re looking to volunteer, find a local sports team, attend cultural events, or start your own community initiative, Organize.Quest connects you with opportunities right in your neighborhood.',
                faqTitle: 'Frequently Asked Questions',
                faq1Q: 'Is Organize.Quest free to use?',
                faq1A: 'Yes! Organize.Quest is completely free for users to browse organizations, create their own groups, and participate in community events.',
                faq2Q: 'How do I create an organization?',
                faq2A: 'Simply sign up for an account, click on the map where you want to place your organization, fill out the details, and publish. Your organization will be visible to everyone in the community.',
                faq3Q: 'Can I edit or delete my organization?',
                faq3A: 'Yes! Go to your profile page and click on "My Organizations" to manage all your created organizations. You can edit details or delete them at any time.',
                faq4Q: 'What types of organizations can I create?',
                faq4A: 'You can create any type of community organization including educational groups, healthcare initiatives, technology communities, non-profits, sports teams, arts collectives, environmental groups, and general community organizations.',
                faq5Q: 'Is my personal information safe?',
                faq5A: 'We take privacy seriously. Your personal information is encrypted and stored securely. We never share your data with third parties without your explicit consent.',
                faq6Q: 'How do I find organizations near me?',
                faq6A: 'Click "Find My Location" on the map and we\'ll show you all organizations in your area. You can also use filters to search by category, distance, and event type.',
                footerTagline: 'Building stronger communities, one connection at a time',
                footerHome: 'Home',
                footerOrgs: 'Organizations',
                footerProfile: 'Profile',
                footerCopyright: '¬© 2025 Organize.Quest. All rights reserved.'
            },
            tr: {
                heroTitle: 'Yerel Topluluk Aƒüƒ±nƒ±zƒ± Olu≈üturun',
                heroDesc: 'Mahallenizde organizasyonlar olu≈üturun, ke≈üfedin ve katƒ±lƒ±n.',
                startBtn: 'Ke≈üfetmeye Ba≈üla',
                loginBtn: 'Giri≈ü Yap',
                openMapBtn: 'Haritayƒ± A√ß',
                myAccount: 'Hesabƒ±m',
                logout: '√áƒ±kƒ±≈ü Yap',
                featuresTitle: 'Neden Organize.Quest?',
                feature1Title: 'ƒ∞nteraktif Harita',
                feature1Desc: 'Kullanƒ±mƒ± kolay interaktif haritada ger√ßek zamanlƒ± g√ºncellemelerle yerel organizasyonlarƒ± ke≈üfedin.',
                feature2Title: 'Topluluk Odaklƒ±',
                feature2Desc: 'Benzer d√º≈ü√ºnen insanlarla baƒülantƒ± kurun ve b√∂lgenizdeki anlamlƒ± ili≈ükiler geli≈ütirin.',
                feature3Title: 'Etkinlik Y√∂netimi',
                feature3Desc: 'Etkinlikler olu≈üturun ve y√∂netin, katƒ±lƒ±mcƒ±larƒ± takip edin ve topluluk aktivitelerini organize edin.',
                feature4Title: 'G√ºvenli ve Emniyetli',
                feature4Desc: 'Verileriniz kurumsal d√ºzeyde g√ºvenlik ve gizlilik kontrolleri ile korunur.',
                howItWorksTitle: 'Nasƒ±l √áalƒ±≈üƒ±r',
                step1Title: 'Hesap Olu≈ütur',
                step1Desc: 'Sadece e-postanƒ±zla saniyeler i√ßinde kaydolun',
                step2Title: 'Haritayƒ± Ke≈üfet',
                step2Desc: 'B√∂lgenizdeki organizasyonlara g√∂z atƒ±n',
                step3Title: 'Olu≈ütur veya Katƒ±l',
                step3Desc: 'Kendiniz ba≈ülatƒ±n veya mevcut gruplara katƒ±lƒ±n',
                step4Title: 'Baƒülan ve B√ºy√ºt',
                step4Desc: 'Topluluk aƒüƒ±nƒ±zƒ± olu≈üturun',
                aboutTitle: 'Organize.Quest Hakkƒ±nda',
                aboutText1: 'Organize.Quest, topluluk organizasyonlarƒ±nƒ± ve etkinlikleri ke≈üfetmeyi, olu≈üturmayƒ± ve katƒ±lmayƒ± kolayla≈ütƒ±rarak yerel topluluklarƒ± g√º√ßlendirmeye adanmƒ±≈ü bir platformdur. G√º√ßl√º topluluklarƒ±n anlamlƒ± baƒülantƒ±lar ve payla≈üƒ±lan deneyimler √ºzerine in≈üa edildiƒüine inanƒ±yoruz.',
                aboutText2: 'ƒ∞ster g√∂n√ºll√º olmak, yerel bir spor takƒ±mƒ± bulmak, k√ºlt√ºrel etkinliklere katƒ±lmak veya kendi topluluk giri≈üiminizi ba≈ülatmak isteyin, Organize.Quest sizi mahallenizde bulunan fƒ±rsatlarla bulu≈üturur.',
                faqTitle: 'Sƒ±k√ßa Sorulan Sorular',
                faq1Q: 'Organize.Quest kullanƒ±mƒ± √ºcretsiz mi?',
                faq1A: 'Evet! Organize.Quest, kullanƒ±cƒ±larƒ±n organizasyonlara g√∂z atmasƒ±, kendi gruplarƒ±nƒ± olu≈üturmasƒ± ve topluluk etkinliklerine katƒ±lmasƒ± i√ßin tamamen √ºcretsizdir.',
                faq2Q: 'Nasƒ±l organizasyon olu≈üturabilirim?',
                faq2A: 'Sadece bir hesap olu≈üturun, organizasyonunuzu yerle≈ütirmek istediƒüiniz haritaya tƒ±klayƒ±n, detaylarƒ± doldurun ve yayƒ±nlayƒ±n. Organizasyonunuz topluluktaki herkes tarafƒ±ndan g√∂r√ºlebilir olacaktƒ±r.',
                faq3Q: 'Organizasyonumu d√ºzenleyebilir veya silebilir miyim?',
                faq3A: 'Evet! Profil sayfanƒ±za gidin ve olu≈üturduƒüunuz t√ºm organizasyonlarƒ± y√∂netmek i√ßin "Organizasyonlarƒ±m" sekmesine tƒ±klayƒ±n. Detaylarƒ± d√ºzenleyebilir veya istediƒüiniz zaman silebilirsiniz.',
                faq4Q: 'Ne t√ºr organizasyonlar olu≈üturabilirim?',
                faq4A: 'Eƒüitim gruplarƒ±, saƒülƒ±k giri≈üimleri, teknoloji topluluklarƒ±, kar amacƒ± g√ºtmeyen kurulu≈ülar, spor takƒ±mlarƒ±, sanat kolektifleri, √ßevre gruplarƒ± ve genel topluluk organizasyonlarƒ± dahil olmak √ºzere her t√ºrl√º topluluk organizasyonu olu≈üturabilirsiniz.',
                faq5Q: 'Ki≈üisel bilgilerim g√ºvende mi?',
                faq5A: 'Gizliliƒüi ciddiye alƒ±yoruz. Ki≈üisel bilgileriniz ≈üifrelenir ve g√ºvenli bir ≈üekilde saklanƒ±r. Verilerinizi a√ßƒ±k izniniz olmadan asla √º√ß√ºnc√º taraflarla payla≈ümayƒ±z.',
                faq6Q: 'Yakƒ±nƒ±mdaki organizasyonlarƒ± nasƒ±l bulabilirim?',
                faq6A: 'Haritada "Konumumu Bul" se√ßeneƒüine tƒ±klayƒ±n, b√∂lgenizdeki t√ºm organizasyonlarƒ± size g√∂stereceƒüiz. Ayrƒ±ca kategoriye, mesafeye ve etkinlik t√ºr√ºne g√∂re arama yapmak i√ßin filtreleri kullanabilirsiniz.',
                footerTagline: 'Daha g√º√ßl√º topluluklar in≈üa ediyoruz, her seferinde bir baƒülantƒ±',
                footerHome: 'Ana Sayfa',
                footerOrgs: 'Organizasyonlar',
                footerProfile: 'Profil',
                footerCopyright: '¬© 2025 Organize.Quest. T√ºm haklarƒ± saklƒ±dƒ±r.'
            }
        };

        function switchLanguage(lang) {
            currentLang = lang;
            document.getElementById('btnEN').classList.toggle('active', lang === 'en');
            document.getElementById('btnTR').classList.toggle('active', lang === 'tr');
            
            const t = translations[lang];
            
            // Update all text
            document.getElementById('heroTitle').textContent = t.heroTitle;
            document.getElementById('heroDesc').textContent = t.heroDesc;
            document.getElementById('heroMapBtn').textContent = t.startBtn;
            document.getElementById('loginBtn').textContent = t.loginBtn;
            document.getElementById('openMapBtn').textContent = t.openMapBtn;
            document.getElementById('featuresTitle').textContent = t.featuresTitle;
            document.getElementById('feature1Title').textContent = t.feature1Title;
            document.getElementById('feature1Desc').textContent = t.feature1Desc;
            document.getElementById('feature2Title').textContent = t.feature2Title;
            document.getElementById('feature2Desc').textContent = t.feature2Desc;
            document.getElementById('feature3Title').textContent = t.feature3Title;
            document.getElementById('feature3Desc').textContent = t.feature3Desc;
            document.getElementById('feature4Title').textContent = t.feature4Title;
            document.getElementById('feature4Desc').textContent = t.feature4Desc;
            document.getElementById('howItWorksTitle').textContent = t.howItWorksTitle;
            document.getElementById('step1Title').textContent = t.step1Title;
            document.getElementById('step1Desc').textContent = t.step1Desc;
            document.getElementById('step2Title').textContent = t.step2Title;
            document.getElementById('step2Desc').textContent = t.step2Desc;
            document.getElementById('step3Title').textContent = t.step3Title;
            document.getElementById('step3Desc').textContent = t.step3Desc;
            document.getElementById('step4Title').textContent = t.step4Title;
            document.getElementById('step4Desc').textContent = t.step4Desc;
            document.getElementById('aboutTitle').textContent = t.aboutTitle;
            document.getElementById('aboutText1').textContent = t.aboutText1;
            document.getElementById('aboutText2').textContent = t.aboutText2;
            document.getElementById('faqTitle').textContent = t.faqTitle;
            document.getElementById('faq1Q').textContent = t.faq1Q;
            document.getElementById('faq1A').textContent = t.faq1A;
            document.getElementById('faq2Q').textContent = t.faq2Q;
            document.getElementById('faq2A').textContent = t.faq2A;
            document.getElementById('faq3Q').textContent = t.faq3Q;
            document.getElementById('faq3A').textContent = t.faq3A;
            document.getElementById('faq4Q').textContent = t.faq4Q;
            document.getElementById('faq4A').textContent = t.faq4A;
            document.getElementById('faq5Q').textContent = t.faq5Q;
            document.getElementById('faq5A').textContent = t.faq5A;
            document.getElementById('faq6Q').textContent = t.faq6Q;
            document.getElementById('faq6A').textContent = t.faq6A;
            document.getElementById('footerTagline').textContent = t.footerTagline;
            document.getElementById('footerHome').textContent = t.footerHome;
            document.getElementById('footerOrgs').textContent = t.footerOrgs;
            document.getElementById('footerProfile').textContent = t.footerProfile;
            document.getElementById('footerCopyright').textContent = t.footerCopyright;
            
            const userMenuName = document.getElementById('userMenuName');
            if (userMenuName) {
                userMenuName.textContent = currentUser ? currentUser.name : t.myAccount;
            }
        }

        function showUserMenu() {
            document.getElementById('loginBtn').style.display = 'none';
            document.getElementById('userMenu').style.display = 'block';
            const userName = currentUser.name || currentUser.email || 'My Account';
            document.getElementById('userMenuName').textContent = userName;
        }

        function hideUserMenu() {
            document.getElementById('loginBtn').style.display = 'block';
            document.getElementById('userMenu').style.display = 'none';
        }

        function openMapApp() {
            document.getElementById('landingPage').style.display = 'none';
            document.getElementById('mapApp').classList.add('active');
            if (!map) setTimeout(initMap, 100);
        }

        function closeMapApp() {
            document.getElementById('mapApp').classList.remove('active');
            document.getElementById('landingPage').style.display = 'block';
        }

        function initMap() {
            map = L.map('map').setView([40.7128, -74.0060], 13);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
            loadOrganizations();
            
            map.on('click', function(e) {
                if (createMode) {
                    selectedLocation = e.latlng;
                    document.getElementById('orgLocationDisplay').value = 
                        `Lat: ${e.latlng.lat.toFixed(4)}, Lng: ${e.latlng.lng.toFixed(4)}`;
                    document.getElementById('createModal').classList.add('show');
                    createMode = false;
                    map.getContainer().style.cursor = 'grab';
                }
            });

            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(function(pos) {
                    const loc = [pos.coords.latitude, pos.coords.longitude];
                    map.setView(loc, 14);
                    userMarker = L.marker(loc).addTo(map).bindPopup('üìç Your Location').openPopup();
                });
            }
        }

        async function loadOrganizations() {
            try {
                const { data, error } = await supabase
                    .from('organizations')
                    .select('*')
                    .order('created_at', { ascending: false });

                if (error) {
                    console.error('Error loading organizations:', error);
                    return;
                }

                organizations = data || [];

                // Filter out expired organizations (past deadline)
                const now = new Date();
                organizations = organizations.filter(org => {
                    if (!org.deadline) return true; // No deadline = never expires
                    const deadline = new Date(org.deadline + (org.deadlineTime ? 'T' + org.deadlineTime : 'T23:59:59'));
                    return deadline > now;
                });

                // refresh membership state from attendees before rendering
                await refreshJoinedOrgs();

                // Clear existing non-user markers before re-adding
                map.eachLayer(function(layer) {
                    if (layer instanceof L.Marker && layer !== userMarker) {
                        map.removeLayer(layer);
                    }
                });
                
                organizations.forEach(org => {
                    let popupContent = `
                        <div style="min-width: 250px;">
                            <h3 style=\"color: var(--primary); margin-bottom: 10px;\">${org.name}</h3>
                            <p><strong>Category:</strong> ${org.category}</p>
                            ${org.description ? `<p>${org.description}</p>` : ''}
                    `;

                    // Event details if present
                    if (org.eventDate) {
                        const eventDate = new Date(org.eventDate);
                        popupContent += `
                            <div style=\"margin-top: 10px; padding: 10px; background: #e3f2fd; border-radius: 5px;\">\n<strong>üìÖ Event:</strong> ${eventDate.toLocaleDateString()}\n${org.eventTime ? `<br><strong>üïê Time:</strong> ${org.eventTime}` : ''}\n${org.maxParticipants ? `<br><strong>üë• Max Attendees:</strong> ${org.maxParticipants}` : ''}\n${org.participants ? `<br><strong>‚úÖ Current:</strong> ${org.participants.length}` : ''}
                            </div>
                        `;
                    }

                    // Organization membership buttons
                    if (currentUser) {
                        const hasJoinedOrg = joinedOrgIds.has(org.id);
                        if (hasJoinedOrg) {
                            popupContent += `
                                <button onclick=\"leaveOrganization('${org.id}')\"
                                        style=\"width: 100%; margin-top: 10px; padding: 8px; background: #dc3545; color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: 600;\">\nLeave Organization\n                                </button>
                            `;
                        } else {
                            popupContent += `
                                <button onclick=\"joinOrganization('${org.id}')\"
                                        style=\"width: 100%; margin-top: 10px; padding: 8px; background: #28a745; color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: 600;\">\nJoin Organization\n                                </button>
                            `;
                        }
                    }

                    // Close content
                    popupContent += `</div>`;

                    const marker = L.marker([org.latitude, org.longitude])
                        .addTo(map)
                        .bindPopup(popupContent);
                });

                console.log('Loaded', organizations.length, 'organizations');
            } catch (err) {
                console.error('Error:', err);
            }
        }

        async function refreshJoinedOrgs() {
            joinedOrgIds = new Set();
            if (!currentUser) return;
            const { data, error } = await supabase
                .from('attendees')
                .select('organization_id')
                .eq('user_id', currentUser.id);
            if (!error && Array.isArray(data)) {
                data.forEach(r => joinedOrgIds.add(r.organization_id));
            }
        }

        function toggleCreateMode() {
            if (!currentUser) {
                alert('Please log in to create an organization!');
                window.location.href = 'profile.html';
                return;
            }

            createMode = !createMode;
            map.getContainer().style.cursor = createMode ? 'crosshair' : 'grab';
            if (createMode) {
                alert('Click on the map to select a location');
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            const savedUser = JSON.parse(localStorage.getItem('currentUser'));
            if (savedUser) {
                currentUser = savedUser;
                showUserMenu();
            }

            document.getElementById('userMenuBtn')?.addEventListener('click', function(e) {
                e.stopPropagation();
                document.getElementById('userDropdown').classList.toggle('show');
            });

            document.addEventListener('click', function() {
                document.getElementById('userDropdown')?.classList.remove('show');
            });

            document.getElementById('logoutDropdown')?.addEventListener('click', async function(e) {
                e.preventDefault();
                try {
                    await supabase.auth.signOut();
                } catch (err) {
                    console.error('Error signing out:', err);
                }
                currentUser = null;
                localStorage.removeItem('currentUser');
                hideUserMenu();
                alert('Successfully logged out!');
            });
            
            document.getElementById('openMapBtn').addEventListener('click', openMapApp);
            document.getElementById('heroMapBtn').addEventListener('click', openMapApp);
            document.getElementById('closeMapBtn').addEventListener('click', closeMapApp);
            
            document.getElementById('findLocationBtn').addEventListener('click', initMap);
            document.getElementById('createOrgBtn').addEventListener('click', toggleCreateMode);
            
            document.getElementById('btnEN').addEventListener('click', () => switchLanguage('en'));
            document.getElementById('btnTR').addEventListener('click', () => switchLanguage('tr'));
            
            document.getElementById('modalCloseBtn').addEventListener('click', () => {
                document.getElementById('createModal').classList.remove('show');
            });

            document.getElementById('createOrgForm').addEventListener('submit', async function(e) {
                e.preventDefault();
                
                if (!selectedLocation) {
                    alert('Please select a location on the map!');
                    return;
                }

                const { data: { user } } = await supabase.auth.getUser();
                
                if (!user) {
                    alert('Please log in to create an organization!');
                    window.location.href = 'profile.html';
                    return;
                }

                // Check user's organization limit (max 3)
                const { data: userOrgs, error: countError } = await supabase
                    .from('organizations')
                    .select('id')
                    .eq('created_by', user.id);

                if (countError) {
                    alert('Error checking organization limit: ' + countError.message);
                    return;
                }

                if (userOrgs && userOrgs.length >= 3) {
                    alert('You can create maximum 3 organizations. Please delete one before creating a new one.');
                    return;
                }

                const { data: userRecord, error: userCheckError } = await supabase
                    .from('users')
                    .select('id')
                    .eq('id', user.id)
                    .single();

                if (userCheckError && userCheckError.code === 'PGRST116') {
                    console.log('User not found in users table, creating...');
                    
                    const { error: createUserError } = await supabase
                        .from('users')
                        .insert([{
                            id: user.id,
                            email: user.email,
                            name: user.user_metadata?.name || user.email.split('@')[0]
                        }]);
                    
                    if (createUserError) {
                        alert('Error setting up user profile: ' + createUserError.message);
                        console.error('User creation error:', createUserError);
                        return;
                    }
                }

                const orgData = {
                    name: document.getElementById('orgName').value,
                    category: document.getElementById('orgCategory').value,
                    description: document.getElementById('orgDescription').value,
                    deadline: document.getElementById('orgDeadline').value,
                    deadlineTime: document.getElementById('orgDeadlineTime').value || null,
                    latitude: selectedLocation.lat,
                    longitude: selectedLocation.lng,
                    created_by: user.id
                };

                try {
                    const { data, error } = await supabase
                        .from('organizations')
                        .insert([orgData])
                        .select();

                    if (error) {
                        alert('Error: ' + error.message);
                        return;
                    }

                    const org = data[0];
                    organizations.push(org);
                    
                    const marker = L.marker([org.latitude, org.longitude])
                        .addTo(map)
                        .bindPopup(`
                            <div style="min-width: 250px;">
                                <h3 style="color: var(--primary); margin-bottom: 10px;">${org.name}</h3>
                                <p><strong>Category:</strong> ${org.category}</p>
                                ${org.description ? `<p>${org.description}</p>` : ''}
                            </div>
                        `);
                    
                    document.getElementById('createModal').classList.remove('show');
                    this.reset();
                    document.getElementById('orgLocationDisplay').value = '';
                    selectedLocation = null;
                    alert('Organization created successfully!');
                } catch (err) {
                    alert('Error creating organization: ' + err.message);
                }
            });

            // Global join/leave handlers for organization membership via Supabase attendees
            window.joinOrganization = function(orgId) {
                (async () => {
                    if (!currentUser) {
                        alert('Please log in to join organizations!');
                        window.location.href = 'profile.html';
                        return;
                    }
                    const { error } = await supabase
                        .from('attendees')
                        .insert([{ organization_id: orgId, user_id: currentUser.id }]);
                    if (error) {
                        alert('Join failed: ' + error.message);
                        return;
                    }
                    joinedOrgIds.add(orgId);
                    alert('Joined organization successfully!');
                    await refreshJoinedOrgs();
                    await loadOrganizations();
                })();
            };

            window.leaveOrganization = function(orgId) {
                (async () => {
                    if (!currentUser) {
                        alert('Please log in first!');
                        return;
                    }
                    if (!confirm('Are you sure you want to leave this organization?')) return;
                    const { error } = await supabase
                        .from('attendees')
                        .delete()
                        .eq('organization_id', orgId)
                        .eq('user_id', currentUser.id);
                    if (error) {
                        alert('Leave failed: ' + error.message);
                        return;
                    }
                    joinedOrgIds.delete(orgId);
                    alert('Left organization successfully!');
                    await refreshJoinedOrgs();
                    await loadOrganizations();
                })();
            };
        });
    </script>
</body>
</html>
