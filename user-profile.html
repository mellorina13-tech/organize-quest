<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Profile - Organize.Quest</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Cdefs%3E%3ClinearGradient id='grad' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' style='stop-color:%235865F2'/%3E%3Cstop offset='100%25' style='stop-color:%234ECDC4'/%3E%3C/linearGradient%3E%3C/defs%3E%3Ccircle cx='50' cy='50' r='45' fill='url(%23grad)'/%3E%3Cpath d='M50 20 L65 40 L85 40 L70 55 L75 75 L50 60 L25 75 L30 55 L15 40 L35 40 Z' fill='white'/%3E%3C/svg%3E">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #5865F2;
            --primary-dark: #4752C4;
            --secondary: #FF6B6B;
            --accent: #4ECDC4;
            --dark: #1a1a2e;
            --light: #f8f9fa;
            --gray: #6c757d;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        nav {
            background: rgba(255, 255, 255, 0.98);
            padding: 1rem 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 1.8rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-decoration: none;
        }

        .btn-secondary {
            background: white;
            color: var(--primary);
            border: 2px solid var(--primary);
            padding: 0.5rem 1.5rem;
            border-radius: 50px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            text-decoration: none;
        }

        .btn-secondary:hover {
            background: var(--primary);
            color: white;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 3rem 2rem;
        }

        .profile-header {
            background: white;
            padding: 3rem;
            border-radius: 20px;
            text-align: center;
            margin-bottom: 2rem;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .profile-avatar {
            width: 150px;
            height: 150px;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            border-radius: 50%;
            margin: 0 auto 1.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 4rem;
            position: relative;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .profile-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .profile-name {
            font-size: 2.5rem;
            font-weight: 800;
            color: var(--dark);
            margin-bottom: 0.5rem;
        }

        .profile-email {
            color: var(--gray);
            font-size: 1.1rem;
            margin-bottom: 1rem;
        }

        .profile-bio {
            max-width: 600px;
            margin: 1.5rem auto;
            color: var(--gray);
            font-size: 1.1rem;
            line-height: 1.8;
        }

        .profile-info {
            display: flex;
            justify-content: center;
            gap: 2rem;
            flex-wrap: wrap;
            margin-top: 2rem;
            padding-top: 2rem;
            border-top: 2px solid #e0e0e0;
        }

        .info-item {
            text-align: center;
        }

        .info-item .label {
            color: var(--gray);
            font-size: 0.9rem;
            margin-bottom: 0.3rem;
        }

        .info-item .value {
            color: var(--dark);
            font-weight: 600;
            font-size: 1.1rem;
        }

        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: white;
            padding: 2rem;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .stat-label {
            color: var(--gray);
            font-size: 1rem;
            margin-top: 0.5rem;
        }

        .section-title {
            background: white;
            padding: 1.5rem 2rem;
            border-radius: 15px;
            margin-bottom: 1.5rem;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .section-title h2 {
            color: var(--dark);
            font-size: 1.8rem;
            margin: 0;
        }

        .org-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .org-card {
            background: white;
            border-radius: 15px;
            padding: 1.5rem;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }

        .org-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
        }

        .org-card h3 {
            color: var(--primary);
            margin-bottom: 0.5rem;
            font-size: 1.3rem;
        }

        .org-card .category {
            display: inline-block;
            padding: 0.3rem 0.8rem;
            background: var(--primary);
            color: white;
            border-radius: 20px;
            font-size: 0.85rem;
            margin-bottom: 1rem;
        }

        .org-card .description {
            color: var(--gray);
            margin-bottom: 1rem;
            line-height: 1.6;
        }

        .org-card .date {
            color: var(--gray);
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .loading {
            text-align: center;
            padding: 3rem;
            color: white;
            font-size: 1.2rem;
        }

        .empty-state {
            background: white;
            padding: 3rem;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .empty-state p {
            color: var(--gray);
            font-size: 1.1rem;
        }

        @media (max-width: 768px) {
            .container {
                padding: 2rem 1rem;
            }

            .profile-header {
                padding: 2rem 1rem;
            }

            .profile-name {
                font-size: 1.8rem;
            }

            .profile-avatar {
                width: 120px;
                height: 120px;
                font-size: 3rem;
            }

            .profile-info {
                gap: 1rem;
            }

            .stats-container {
                grid-template-columns: repeat(2, 1fr);
            }

            .org-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <nav>
        <div class="nav-container">
            <a href="index.html" class="logo">üåê Organize.Quest</a>
            <a href="organizations.html" class="btn-secondary">‚Üê Back to Organizations</a>
        </div>
    </nav>

    <div class="container">
        <div id="loadingState" class="loading">
            Loading user profile...
        </div>

        <div id="profileContent" style="display: none;">
            <div class="profile-header">
                <div class="profile-avatar" id="userAvatar">üë§</div>
                <h1 class="profile-name" id="userName">User Name</h1>
                <p class="profile-email" id="userEmail">user@email.com</p>
                <p class="profile-bio" id="userBio"></p>
                
                <div class="profile-info">
                    <div class="info-item" id="locationInfo" style="display: none;">
                        <div class="label">üìç Location</div>
                        <div class="value" id="userLocation">-</div>
                    </div>
                    <div class="info-item" id="phoneInfo" style="display: none;">
                        <div class="label">üìû Phone</div>
                        <div class="value" id="userPhone">-</div>
                    </div>
                    <div class="info-item" id="interestsInfo" style="display: none;">
                        <div class="label">üí° Interests</div>
                        <div class="value" id="userInterests">-</div>
                    </div>
                </div>
            </div>

            <div class="stats-container">
                <div class="stat-card">
                    <div class="stat-number" id="totalOrgs">0</div>
                    <div class="stat-label">Organizations Created</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="activeOrgs">0</div>
                    <div class="stat-label">Active Organizations</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="totalMembers">0</div>
                    <div class="stat-label">Total Members</div>
                </div>
            </div>

            <div class="section-title">
                <h2>üìã Organizations Created</h2>
            </div>

            <div id="organizationsList" class="org-grid"></div>
        </div>

        <div id="errorState" class="empty-state" style="display: none;">
            <h2 style="color: var(--danger); margin-bottom: 1rem;">‚ö†Ô∏è User Not Found</h2>
            <p>The user profile you're looking for doesn't exist or has been removed.</p>
            <a href="organizations.html" class="btn-secondary" style="display: inline-block; margin-top: 1rem;">Back to Organizations</a>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        const SUPABASE_URL = 'https://ymrxfbkghznrosgfqwrh.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InltcnhmYmtnaHpucm9zZ2Zxd3JoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg0NzQ4MTMsImV4cCI6MjA3NDA1MDgxM30.GyrbrTmWMc6--zCUcfKwc-2qlsBI0z3oly8iv9Fq9-0';
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        const urlParams = new URLSearchParams(window.location.search);
        const userId = urlParams.get('id');

        if (!userId) {
            showError();
        } else {
            loadUserProfile(userId);
        }

        async function loadUserProfile(userId) {
            try {
                const { data: user, error: userError } = await supabase
                    .from('users')
                    .select('*')
                    .eq('id', userId)
                    .single();

                if (userError || !user) {
                    showError();
                    return;
                }

                displayUserProfile(user);

                const { data: organizations, error: orgsError } = await supabase
                    .from('organizations')
                    .select('*, attendees(user_id)')
                    .eq('created_by', userId)
                    .order('created_at', { ascending: false });

                if (!orgsError) {
                    displayOrganizations(organizations || []);
                    updateStats(organizations || []);
                }

                document.getElementById('loadingState').style.display = 'none';
                document.getElementById('profileContent').style.display = 'block';

            } catch (err) {
                console.error('Error loading profile:', err);
                showError();
            }
        }

        function displayUserProfile(user) {
            document.getElementById('userName').textContent = user.name || 'Anonymous User';
            document.getElementById('userEmail').textContent = user.email || '';

            if (user.avatar_url) {
                document.getElementById('userAvatar').innerHTML = `<img src="${user.avatar_url}" alt="${user.name}">`;
            } else {
                document.getElementById('userAvatar').textContent = 'üë§';
            }

            if (user.bio) {
                document.getElementById('userBio').textContent = user.bio;
                document.getElementById('userBio').style.display = 'block';
            }

            if (user.city || user.country) {
                const location = [user.city, user.country].filter(Boolean).join(', ');
                document.getElementById('userLocation').textContent = location;
                document.getElementById('locationInfo').style.display = 'block';
            }

            if (user.phone) {
                document.getElementById('userPhone').textContent = user.phone;
                document.getElementById('phoneInfo').style.display = 'block';
            }

            if (user.interests) {
                document.getElementById('userInterests').textContent = user.interests;
                document.getElementById('interestsInfo').style.display = 'block';
            }
        }

        function displayOrganizations(organizations) {
            const container = document.getElementById('organizationsList');

            if (organizations.length === 0) {
                container.innerHTML = '<div class="empty-state"><p>This user hasn\'t created any organizations yet.</p></div>';
                return;
            }

            const categoryIcons = {
                'Education': 'üéì',
                'Healthcare': 'üè•',
                'Technology': 'üíª',
                'Non-Profit': 'ü§ù',
                'Sports': '‚öΩ',
                'Arts': 'üé®',
                'Environment': 'üå±',
                'Community': 'üèôÔ∏è'
            };

            const now = new Date();
            const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());

            const activeOrgs = organizations.filter(org => {
                if (!org.deadline) return true;
                const orgDate = new Date(org.deadline);
                return orgDate >= today;
            });

            container.innerHTML = activeOrgs.map(org => {
                const icon = categoryIcons[org.category] || 'üìå';
                const memberCount = org.attendees ? org.attendees.length : 0;

                return `
                    <div class="org-card">
                        <h3>${icon} ${org.name}</h3>
                        <span class="category">${org.category}</span>
                        ${org.description ? `<p class="description">${org.description}</p>` : ''}
                        ${org.deadline ? `
                            <div class="date">
                                üìÖ ${new Date(org.deadline).toLocaleDateString()}
                            </div>
                        ` : ''}
                        <div class="date" style="margin-top: 0.5rem;">
                            üë• ${memberCount} member${memberCount !== 1 ? 's' : ''}
                        </div>
                    </div>
                `;
            }).join('');
        }

        function updateStats(organizations) {
            const now = new Date();
            const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());

            const activeOrgs = organizations.filter(org => {
                if (!org.deadline) return true;
                const orgDate = new Date(org.deadline);
                return orgDate >= today;
            });

            const totalMembers = organizations.reduce((sum, org) => {
                return sum + (org.attendees ? org.attendees.length : 0);
            }, 0);

            document.getElementById('totalOrgs').textContent = organizations.length;
            document.getElementById('activeOrgs').textContent = activeOrgs.length;
            document.getElementById('totalMembers').textContent = totalMembers;
        }

        function showError() {
            document.getElementById('loadingState').style.display = 'none';
            document.getElementById('profileContent').style.display = 'none';
            document.getElementById('errorState').style.display = 'block';
        }
    </script>
</body>
</html>
